[phases.setup]
nixPkgs = [
    "postgresql",
    "python3",
    "python3Packages.pip",
    "python3Packages.virtualenv"
]

[phases.install]
path = "backend"
cmds = [
    "python3 -m venv .venv",
    ". .venv/bin/activate",
    "pip install --no-cache-dir -r requirements.txt"
]

[phases.build]
cmds = [
    "cd ../frontend && npm install && npm run build",
    "mv ../frontend/build ../backend/static"
]

[start]
cmd = ". .venv/bin/activate && gunicorn 'app:app' --bind=0.0.0.0:$PORT"
workdir = "backend"